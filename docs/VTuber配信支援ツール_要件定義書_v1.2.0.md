# VTuber配信支援ツール  
## プロダクト要件定義書  
〜「わんコメ＋セトリスタ」の上位互換を目指して〜  

- Version: **1.2.0**
- 作成日: **2025-12-17**
- ステータス: **ドラフト（レビュー反映済み）**

---

## 変更概要
### v1.1.1 → v1.2.0（重要修正）
1) **YouTubeコメント取得方式のリスク低減（最重要）**  
- `liveChatMessages.streamList` は **YouTube Live Streaming API の公式仕様として公開**されているため「内部API」ではない（gRPCストリーミング接続）  
  - `streamList` の公式リファレンス: YouTube Live Streaming API「LiveChatMessages: streamList」  
  - 公式ガイド「Streaming Live Chat」には `streamList.proto` と gRPC クライアント生成手順があり、接続先は `youtube.googleapis.com:443`、認証は **API key または OAuth2 トークン**の例が示されている  
- 一方で **実運用の安定性（HTTP/2 / プロキシ / 切断復帰）**は環境差が出るため、MVPの“必須”から外し、以下に方針転換：  
  - **MVPベースライン**: `liveChatMessages.list`（REST）を `pollingIntervalMillis` 厳守で最適化ポーリング  
  - **追加価値（Feature Flag）**: `streamList` は **スパイク（PoC）で実用性を先に検証**し、成立すれば段階導入

2) **クォータ戦略の明文化（BYOKを実質必須に）**  
- YouTube Data API の **デフォルト割当は 10,000 units/day**（拡張にはコンプライアンス監査が必要）  
- `liveChatMessages.list` は実運用上 **高頻度アクセスになりやすい**ため、共有キー方式は破綻しやすい  
- 方針: **BYOK（ユーザー自身のAPIキー）を基本運用（MVPから前提）**にする  
  - 共有キーは “体験デモ用途” まで（短時間/少人数）  
  - 本番利用はユーザーのGoogle Cloudプロジェクトに負荷分散

3) **テンプレエンジンのMVP要件を縮小（表現力優先）**  
- MVPでは “汎用エンジン” ではなく、**神テンプレの表現力を最大化する実装**に寄せる  
  - MVP: 色・位置・ON/OFF程度の「簡易設定」  
  - Phase 2: DOM構造やコンポーネント合成まで含む「完全エンジン」

4) **OAuth警告（未確認アプリ）への対策を明確化**  
- MVPは **API key（BYOK）中心**でOAuthを回避（可能な範囲で）  
- OAuthが必要なユースケース（例: 書き込み、限定配信等）は Phase 2以降に拡張し、**Testing運用（テストユーザー登録/100枠）**または検証申請のタスクを計画に含める

5) **更新通知をMustへ格上げ**  
- デスクトップアプリは “配布済みバイナリの更新” が最大の運用リスクのため、MVPから **起動時更新チェック→通知**を必須化

---

## Part A: エグゼクティブサマリー

### 1. プロダクトビジョン
**ビジョンステートメント**  
「VTuber配信者が、プロクオリティのデザインと統合された機能を、ひとつのツールで手に入れられる世界を創る」

**ミッション**  
わんコメの連携しやすさ＋セトリスタのデザイン性＋プロクリエイターの品質を統合し、「これさえあればOK」と言われる配信支援ツールを提供する。

### 2. 課題認識（VTuberからの生の声）
登録者7万人の現役VTuberから得たフィードバックに基づく課題認識:

- **デザインクオリティ不足**: 既存サービス（Alive Studio等）の素材は質感が低く見える  
- **プロ水準の要求**: ミナトデザイン・唐揚丸レベルの洗練されたデザインが必要  
- **量より質**: 低品質な素材をたくさん揃えるくらいなら提供しなくて良い  
- **オールインワン志向**: 複数ツールの併用は煩雑、ひとつで完結したい  

### 3. 解決策の方向性

| 戦略軸 | 具体的アプローチ |
|---|---|
| 統合・連携 | コメント表示＋セットリスト＋画面演出を単一UIに統合 |
| デザイン品質 | パートナークリエイター制度による高品質テンプレート |
| テンプレート方式 | **神テンプレ1つ（MVP）＋“簡易設定”＋段階的にエンジン化** |
| 法人仲介 | 企業案件専門クリエイターへの依頼仲介サービス |

### 4. 前提・制約
- 開発形態: **個人開発（AI駆動）**／スペック駆動で実装  
- MVP方針: **最短でβ公開 → フィードバックで継続改善**  
- 対象環境: **Windows / YouTube / OBS / VTube Studio** 前提  
- データ取得: **公式API前提**（非公式API/スクレイピングは不採用）  
- 品質方針: 「多いけど使われない」ではなく **少数精鋭で刺す**  

---

## Part B: ターゲットユーザー定義

### 1. ターゲットセグメント（仮説）

| セグメント | 登録者数 | 推定人数 | 優先度 |
|---|---:|---:|---|
| Tier 1 | 1,000〜10,000人 | 約20,000人 | ★★★ 最優先 |
| Tier 2 | 10,000〜100,000人 | 約5,000人 | ★★ 高 |
| Tier 3 | 100〜1,000人 | 約30,000人 | ★ 中 |

### 2. ペルソナ: 「歌枠メイン個人勢」
- 名前: 星宮ミライ（仮名）  
- 登録者数: 約15,000人  
- 配信頻度: 週4〜5回（歌枠2回、雑談2回、ゲーム1回）  
- 使用ツール: OBS Studio, VTube Studio, わんコメ, セトリスタ  
- ペインポイント:
  - 配信前に4〜5個のソフトを起動・設定するのが面倒
  - わんコメとセトリスタのデザインを統一するのに苦労
  - 背景を季節ごとに変えたいが、依頼費用（3〜5万円/枚）が高い
  - 大手VTuberのようなリッチな演出に憧れるが、技術的に実現できない

---

## Part C: MVP機能仕様（Phase 1）

### 1. MVP定義
Phase 1では **コア価値＝“統合”×“神デザイン”×“安定動作”** を最優先し、後工程で拡張する。

### 2. MVP機能一覧

| ID | 機能名 | 概要 | MVP必須 |
|---|---|---|---|
| F01 | コメント取得・表示 | YouTube Liveからコメント取得、OBS表示 | 必須 |
| F02 | セットリスト管理 | 楽曲リスト作成、曲順管理、OBS表示 | 必須 |
| F03 | 高品質テンプレート | プロデザイナー制作の統一デザインセット | 必須 |
| F04 | OBSブラウザソース連携 | ドラッグ&ドロップでOBSに追加 | 必須 |
| F05 | コメント読み上げ | VOICEVOX連携による自動読み上げ | Phase 2 |
| F06 | VTube Studio連携 | ホットキー実行、表情変更API連携 | Phase 2 |
| F07 | 物理演出エンジン | コメント/ギフト落下、インタラクション | Phase 3 |

---

## Part C-1: YouTubeコメント取得（最重要・更新版）

### F01: コメント取得・表示（YouTube Live）

#### 1) 取得方式（MVP方針）
**MVPベースライン（P0）**  
- `liveChatMessages.list`（REST）で取得し、レスポンスの `pollingIntervalMillis` を厳守してポーリングする  

**追加価値（P1 / Feature Flag）**  
- `liveChatMessages.streamList`（gRPC server-streaming）を **スパイク（PoC）で検証**し、成立すれば段階導入  
  - `streamList` は公式仕様として公開されており、継続接続で低遅延に受け取れる（公式リファレンス）  
  - 公式ガイドに `stream_list.proto` / gRPC生成例がある（Streaming Live Chat）

#### 2) 認証方式（MVP方針）
- **BYOK（ユーザー自身のAPI key）を基本運用（MVPから前提）**  
  - 理由: 共有キーだとクォータ枯渇が早い／監査無しでの割当増が難しい  
- OAuthは “未確認アプリ” 警告による離脱を招きやすいため、MVPでは避ける（必要になった時点でPhase 2で対応）

#### 3) クォータ前提と運用設計
- デフォルト割当: **10,000 units/day**（プロジェクト単位。拡張には監査が必要）  
- `liveChatMessages.list` のクォータコストは公式表で明示されない場合があるため、**自プロジェクトのメトリクスで実測・監視**する  
  - 実務上は 1回あたり複数ユニット消費として扱い、早期に安全側で設計する（後述の推定モデル）

**推定モデル（安全側の運用設計）**  
- 仮に `list` が 5 units/回 とすると、10,000 units/day → **約2,000回/日**  
  - 5秒間隔: 720回/時 → **約2.78時間で枯渇**  
  - 10秒間隔: 360回/時 → **約5.56時間で枯渇**  
→ 共有キー前提で長時間配信を支えるのは難しいため、BYOKは必須レベルで合理的。

#### 4) 仕様（MVP）
| 項目 | 仕様 |
|---|---|
| 対応プラットフォーム | YouTube Live（MVP）、Twitch・ニコ生（Phase 2） |
| 取得方式 | **MVPは `liveChatMessages.list` を主系統**（`pollingIntervalMillis` を厳守） |
| 更新制御 | `pollingIntervalMillis` を尊重し、最短でも“直前リクエスト＋指定待機”を守る |
| エラーハンドリング | rateLimitExceeded 等は指数バックオフ、切断/失敗時は再試行。`nextPageToken` を維持 |
| 表示形式 | HTMLテンプレート（OBSブラウザソース用） |
| コマンド解析 | `!req` 等のコマンドは **レート制限＋ロール制御**（モデ/メン限など） |
| 受け入れ基準 | 2時間配信で取得停止しない（自動復帰含む）／遅延が体感許容内 |

---

## Part C-2: セットリスト

### F02: セットリスト管理
| 項目 | 仕様 |
|---|---|
| 楽曲データベース | 曲名、アーティスト、カテゴリ、タグ管理（最小は曲名のみでも可） |
| セットリスト作成 | ドラッグ&ドロップで曲順編集 |
| 表示テンプレート | **MVP: 神テンプレと統一した“1種＋バリアント（2〜3）”** |
| タイムスタンプ | 曲切替時に自動記録、YouTube概要欄用にコピー出力（MVP価値が高い） |
| 受け入れ基準 | セトリスタ“機能”の代替が可能（運用負荷が下がる） |

---

## Part C-3: デザイン（差別化の核）

### F03: 高品質テンプレート（最重要）
| 項目 | 仕様 |
|---|---|
| MVP提供数 | **1セット（神テンプレ）＋カラーバリアント**（品質最優先） |
| セット内容 | 背景＋コメント枠＋セトリ枠＋小物（統一感） |
| MVPカスタム | **簡易設定**（色・位置・ON/OFF・フォント程度） |
| Phase2で拡張 | DOM構造/構成の可変・複数テンプレ切替・テンプレSDK |
| 品質基準 | ミナトデザイン・唐揚丸レベルを指標（方向性の目標値） |
| 受け入れ基準 | VTuberモニター5名中4名以上が「使いたい」と回答 |

---

## Part C-4: OBS連携

### F04: OBSブラウザソース連携
| 項目 | 仕様 |
|---|---|
| 出力形態 | `http://localhost:{port}/overlay/comment` および `http://localhost:{port}/overlay/setlist` を提供 |
| セットアップ | URLコピー＋ワンクリップボード／OBS追加手順のガイド（ウィザード連携） |
| 負荷制御 | DOM更新頻度・アニメ負荷を制御（OBS落ち回避） |
| 受け入れ基準 | OBSで簡単に動き、配信中も安定（落ちない・ズレない） |

---

## Part D: 技術アーキテクチャ（更新版）

### 1. 推奨技術スタック
- **Desktop**: Tauri 2.0（Rust）
- **UI**: React + TypeScript
- **Overlay**: HTML/CSS +（必要に応じて）Canvas/WebGL
- **Data**: SQLite（ローカル永続）
- **Realtime**: WebSocket（localhost）
- **YouTube（MVP）**: Live Streaming API `liveChatMessages.list`（REST）
- **YouTube（オプション）**: `liveChatMessages.streamList`（gRPC）  
  - Rust案: `tonic`（PoCで成立確認後に採用）
- **VTS連携（Phase2）**: VTube Studio WebSocket API
- **更新通知（MVP Must）**: Tauri Updater（起動時チェック→通知）

### 2. システム構成図（論理）
```
【Tauri 2.0 アプリケーション】
├─ React UI（設定画面、プレビュー、ウィザード）
├─ Rust Backend（API通信、データ処理、レート制御）
├─ SQLite（設定、楽曲、ログ）
└─ WebSocket/HTTP Server（localhost）

        ↓

【OBS Studio】
├─ ブラウザソース: コメント表示
└─ ブラウザソース: セットリスト表示
```

### 3. セキュリティ/権利/配布
**APIキー保護**
- 平文保存禁止（WindowsはOSセキュアストレージ/DPAPI相当を利用）
- ログ出力時のマスキング必須

**テンプレ権利**
- 再配布禁止、利用範囲（配信利用可／素材再販売不可）を明文化
- クリエイター契約テンプレを用意（改変可否、クレジット、二次利用、納品形式）

**配布/更新（MVP）**
- **起動時に更新チェックし、通知する（Must）**
- 重大バグ時に“確実に更新へ誘導できる導線”をMVPから持つ

---

## Part E: 開発タスク・優先順位（更新版）

### 1. タスク分解（WBS）

**Phase 1: MVP（目標: 8週間）**  
※ “テンプレ制作がボトルネック化しない”よう **エンジンとアセット制作を分離**する。

| ID | タスク | 工数 | 依存 | 優先度 |
|---|---|---:|---|---|
| T01 | Tauri 2.0プロジェクト初期化 | 2日 | - | P0 |
| T02 | YouTube: BYOK(API key)入力UI＋動画ID→activeLiveChatId取得＋`liveChatMessages.list`実装 | 7日 | T01 | P0 |
| T03 | `pollingIntervalMillis`順守・バックオフ・再試行・`nextPageToken`維持 | 3日 | T02 | P0 |
| T04 | WebSocket/ローカルHTTPサーバー実装 | 3日 | T01 | P0 |
| T05 | コメント表示オーバーレイ（HTML/CSS） | 5日 | T04 | P0 |
| T06 | セットリストUI・データ管理（最小） | 6日 | T01 | P0 |
| T07 | セットリスト表示オーバーレイ（統一デザイン） | 4日 | T06 | P0 |
| T08 | **神テンプレ実装（表現力優先）＋簡易設定（色/位置/ON-OFF）** | 5日 | T05,T07 | P0 |
| T09 | 神テンプレ1セット制作（外注/協業含む、並行可能） | 8日 | T08 | P0 |
| T10 | 初回設定ウィザード＋テストモード＋プレビュー | 5日 | T02,T05 | P1 |
| T11 | 認証情報保護（API keyのOSセキュア保存） | 2日 | T02 | P1 |
| T12 | インストーラー＋**起動時更新チェック/通知（Must）** | 4日 | All | P1 |
| T13 | **PoC: `streamList`（gRPC）疎通・安定性検証（Feature Flag前提）** | 3日 | T02 | P1 |

**Phase 1 合計工数（目安）**: 約57日（10〜11週間相当）  
> ただし T09 を外部協力で並行化し、T13は「成立したら導入/未成立なら次フェーズ」にすることで8週間に寄せられる。

### 2. 優先順位マトリクス（更新版）
|  | 実装難易度: 低 | 実装難易度: 高 |
|---|---|---|
| 重要度: 高 | 【優先実装】<br>`list`最適化（安定）<br>OBS連携<br>オンボーディング（最低限） | 【計画的実装】<br>神テンプレ（品質担保） |
| 重要度: 低 | 【余裕があれば】<br>リクエスト受付（荒らし対策込み） | 【Phase 2以降】<br>完全テンプレエンジン<br>VTS連携<br>物理演出 |

---

## Part F: 開発ロードマップ（更新版）

### Phase 1: MVP（Month 1-2）
- YouTube Liveコメント取得・表示（**`list`最適化ポーリング**）
- セットリスト管理・表示（最小）
- **神テンプレ1種類＋バリアント**（表現力優先）
- OBSブラウザソース連携
- **初回設定ウィザード/テストモード/プレビュー**
- **更新チェック/通知（Must）**
- 追加: `streamList` は PoC結果に応じて Feature Flag導入

### Phase 2: 機能拡充（Month 3-4）
- OAuth対応（必要スコープ最小化／検証・審査計画）
- 完全テンプレエンジン化（SDK/マーケット前提）
- VOICEVOX読み上げ、VTS連携、初見判定、テンプレ拡充 等

---

## Part G: KPI・成功指標（抜粋）
- テンプレート満足度: 5名中4名以上が「使いたい」と回答
- 安定性: 2時間配信中のクラッシュ率 < 1%
- 更新到達: 重大バグ修正の配布から 7日以内に 80% が更新

---

## Part H: リスク分析（更新版）

### 1. 技術リスク
| リスク | 発生確率 | 影響度 | 対策 |
|---|---|---|---|
| YouTube APIクォータ枯渇 | 中 | 高 | **BYOK前提**、`pollingIntervalMillis`順守、監視、PoCで`streamList`有効化検討 |
| `streamList`の接続安定性（HTTP/2/proxy） | 中 | 中 | PoC(T13)で成立確認、未成立ならPhase 2へ移管し`list`で継続 |
| OBSブラウザソース互換性/負荷 | 低 | 中 | 軽量DOM/Canvas、更新頻度制御 |
| 個人開発のリソース限界 | 高 | 中 | MVP厳格化、並行タスク整理、AI駆動で短縮 |

### 2. ビジネスリスク
| リスク | 発生確率 | 影響度 | 対策 |
|---|---|---|---|
| OAuth警告（未確認アプリ）で離脱 | 中 | 中 | MVPはAPI key中心、OAuthはPhase2で対応/検証 |
| テンプレ品質が刺さらない | 中 | 高 | “神テンプレ”集中、VTuberレビューで合格まで磨く |

---

## 参考資料（URLはコードとして記載）
```text
YouTube LiveChatMessages.list: https://developers.google.com/youtube/v3/live/docs/liveChatMessages/list
YouTube LiveChatMessages.streamList: https://developers.google.com/youtube/v3/live/docs/liveChatMessages/streamList
Streaming Live Chat（gRPCガイド）: https://developers.google.com/youtube/v3/live/streaming-live-chat
YouTube Quota & Compliance Audits（10,000 units/dayと監査）: https://developers.google.com/youtube/v3/guides/quota_and_compliance_audits
```

---  
**End of Document (v1.2.0)**
